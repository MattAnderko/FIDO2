{
  auto_https off
}

:8080 {
  encode zstd gzip

  header {
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    Referrer-Policy "no-referrer"
    Permissions-Policy "publickey-credentials-get=(self)"
  }

  # API FIRST – anything under /api goes to the backend AS-IS (no stripping)
  handle /api/* {
    reverse_proxy backend:8000
  }

  # Everything else → Flutter frontend (nginx)
  handle {
    reverse_proxy frontend:80
  }
}
